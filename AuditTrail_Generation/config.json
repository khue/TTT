{
    "i9tracker":{
        "host":"SQLVS201NJ",
        "user":"I9File_Generator",
        "pwd":"N9?mLFo0jk2!SC@t",
        "db":"I9Tracker",
        "driver":"{ODBC Driver 11 for SQL Server}",
        "audit_template": "<html><head><style> table { border-collapse: collapse;  width: 100%; }  th, td { text-align: left; padding: 8px; } tr:nth-child(even) {background-color:#dddbdb;} </style></head><body><div style='text-align: center; font-weight: bold;'>      Audit Trail for I9-ID: {{ i9id }}</div><br><br><div style='text-align: center;'><table border='1' align='center' style='border-style: solid; border-width: 1px; border-color:#000000; width:1000px;'><tr bgcolor='#bec1c6'><th>Fragomen ID</th><th>I-9 ID</th><th>DateAndTime</th><th>Username</th><th>Action</th><th>Details</th></tr> {% for rec in trows %} <tr><td>{{ rec.FragomenID }}</td><td>{{ rec.I9ID }}</td><td>{{ rec.DateAndTime.strftime('%m/%d/%Y %I:%M:%S %p ') }}</td><td>{{ rec.Username }}</td><td>{{ rec.Action }}</td><td>{{ rec.Details }}</td> </tr>{% endfor %} </table> </div> </body>     </html>",
        "Type1" : "SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id,'') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID=i9s.I9ID AND asig.S1Completion=1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp<=i9s.Section1CompletedTime ORDER BY  LoginDTSTamp DESC), ISNULL( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S1Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section1CompletedTime ORDER BY  LoginDTSTamp DESC), (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id=i9s.i9id AND signaturesection=1 AND SignatureSubSection=1))) AS 'DateAndTime', isnull(e.Username,'') + ' (Employee) ID: ' + CONVERT(VARCHAR,e.EmployeeID) AS 'Username', 'Employee Login' AS 'Action', '' AS 'AuditValue', '1' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid=e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid=e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id=sig.I9ID AND sig.SignatureSection=1 AND sig.SignatureSubSection=1 WHERE i9s.i9id = @I9Id UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S1Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section1CompletedTime ORDER BY  LoginDTSTamp DESC), (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id=i9s.i9id AND signaturesection=1 AND SignatureSubSection=1)) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username', 'Section 1 Personal Information Entered' AS 'Action', '' AS 'AuditValue', '2' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 WHERE i9s.i9id = @I9Id UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S1Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section1CompletedTime ORDER BY  LoginDTSTamp DESC), (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id=i9s.i9id AND signaturesection=1 AND SignatureSubSection=1)) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username', 'Section 1 Attestation Selected' AS 'Action', '' AS 'AuditValue', '3' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 WHERE i9s.i9id = @I9Id UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S1Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section1CompletedTime ORDER BY  LoginDTSTamp DESC), (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id=i9s.i9id AND signaturesection=1 AND SignatureSubSection=1)) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username', 'Section 1 Preparer/Translator Selected (Yes/No)' AS 'Action', '' AS 'AuditValue', '4' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 WHERE i9s.i9id = @I9Id AND i9s.I9VersionID >= 7 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S1PrepSave = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section1CompletedTime ORDER BY  LoginDTSTamp DESC), (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id=i9s.i9id AND signaturesection=1 AND SignatureSubSection=1)) AS 'DateAndTime', isnull(e.Username, '') + ' (Preparer/Translator) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username', 'Section 1 Preparer/Translator Info Added' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 2 WHERE i9s.i9id = @I9Id UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 1 AND SignatureSubSection = 2),null) AS 'DateAndTime', isnull(e.Username, '') + ' (Preparer/Translator) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username', 'Section 1 Preparer/Translator signature' AS 'Action', '' AS 'AuditValue', '5' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 2 WHERE i9s.i9id = @I9Id UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 1 AND SignatureSubSection = 1),null) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username', 'Section 1 Signature' AS 'Action', '' AS 'AuditValue', '6' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 WHERE i9s.i9id = @I9Id UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Completion = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime AND asig.LoginDTStamp> (SELECT EmployeeSignatureDate FROM I9ValidatedS1 i9s1 WITH(NOLOCK) WHERE i9s1.I9ID=i9s.I9ID) ORDER BY  LoginDTSTamp DESC),isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime AND asig.LoginDTStamp> (SELECT EmployeeSignatureDate FROM I9ValidatedS1 i9s1 WITH(NOLOCK) WHERE i9s1.I9ID=i9s.I9ID) ORDER BY  LoginDTSTamp DESC),i9s.Section2CompletedTime)) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Employer Representative Login' AS 'Action', '' AS 'AuditValue', '1' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime AND asig.LoginDTStamp> (SELECT EmployeeSignatureDate FROM I9ValidatedS1 i9s1 WITH(NOLOCK) WHERE i9s1.I9ID=i9s.I9ID) ORDER BY  LoginDTSTamp DESC),i9s.Section2CompletedTime) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'List A Documents Entered' AS 'Action', '' AS 'AuditValue', '2' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN i9validatedS2 i9s2 with(nolock) ON i9s.i9id = i9s2.i9id left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s2.ListADocumentID is NOT null UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime AND asig.LoginDTStamp> (SELECT EmployeeSignatureDate FROM I9ValidatedS1 i9s1 WITH(NOLOCK) WHERE i9s1.I9ID=i9s.I9ID) ORDER BY  LoginDTSTamp DESC),i9s.Section2CompletedTime) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'List B Documents Entered' AS 'Action', '' AS 'AuditValue', '3' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN i9validatedS2 i9s2 with(nolock) ON i9s.i9id = i9s2.i9id left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s2.ListBDocumentID is NOT null UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime AND asig.LoginDTStamp> (SELECT EmployeeSignatureDate FROM I9ValidatedS1 i9s1 WITH(NOLOCK) WHERE i9s1.I9ID=i9s.I9ID) ORDER BY  LoginDTSTamp DESC),i9s.Section2CompletedTime) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'List C Documents Entered' AS 'Action', '' AS 'AuditValue', '4' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN i9validatedS2 i9s2 with(nolock) ON i9s.i9id = i9s2.i9id left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s2.ListCDocumentID is NOT null UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime ORDER BY  LoginDTSTamp DESC),i9s.Section2CompletedTime) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Additional Info box entered' AS 'Action', '' AS 'AuditValue', '5' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN i9validatedS2 i9s2 with(nolock) ON i9s.i9id = i9s2.i9id left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s2.AdditionalInfoListB is NOT null UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime AND asig.LoginDTStamp> (SELECT EmployeeSignatureDate FROM I9ValidatedS1 i9s1 WITH(NOLOCK) WHERE i9s1.I9ID=i9s.I9ID) ORDER BY  LoginDTSTamp DESC),i9s.Section2CompletedTime) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Section 2 Hire Date Entered' AS 'Action', '' AS 'AuditValue', '6' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN i9validatedS2 i9s2 with(nolock) ON i9s.i9id = i9s2.i9id left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s2.HireDate is NOT null UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 2 AND SignatureSubSection = 1),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Section 2 Signature' AS 'Action', '' AS 'AuditValue', '7' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S3Completion = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section3CompletedTime ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Employer Representative Login' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 3 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 3 AND SignatureSubSection = 1 ORDER BY  I9SignatureID) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s.IsReverification = 1 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S3Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section3CompletedTime ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Reverification Documents Entered' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 3 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 3 AND SignatureSubSection = 1 ORDER BY  I9SignatureID) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s.IsReverification = 1 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 3 AND SignatureSubSection = 1),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Section 3 Signature' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 3 AND sig.SignatureSubSection = 1 left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s.IsReverification = 1 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S3Completion = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section3CompletedTime ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Section 3 Rehire Rep Login' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 3 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 3 AND SignatureSubSection = 1 ORDER BY  I9SignatureID) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s.IsRehire = 1 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S3Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section3CompletedTime ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Section 3 Rehire Date Entered' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 3 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 3 AND SignatureSubSection = 1 ORDER BY  I9SignatureID) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s.IsRehire = 1 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 3 AND SignatureSubSection = 1),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Section 3 Rehire signature' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 3 AND sig.SignatureSubSection = 1 left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s.IsRehire = 1 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.TransferControl = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= tc.DTStamp ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', isnull(u.username, '') + ' (Authorized Rep) ID: ' + isnull(CONVERT(VARCHAR, u.UserID), '') AS 'Username', 'Employer Representative Login' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid left outer JOIN USCISTransferControl tc with(nolock) ON tc.uscistransfercontrolid = (SELECT max(uscistransfercontrolid) FROM USCISTransferControl with(nolock) WHERE employeeid = e.employeeid AND casenumber is null) left outer JOIN users u with(nolock) ON tc.UserId = u.UserID WHERE tc.uscistransfercontrolid is NOT null AND i9s.i9id = @I9Id UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(tc.dtstamp, null) AS 'DateAndTime', isnull(u.Username, '') + ' (Authorized Rep) ID: ' + isnull(CONVERT(VARCHAR, u.UserID), '') AS 'Username', 'Employer Rep Logs Off (Transfer Control)' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid left outer JOIN USCISTransferControl tc with(nolock) ON tc.uscistransfercontrolid = (SELECT max(uscistransfercontrolid) FROM USCISTransferControl with(nolock) WHERE employeeid = e.employeeid AND casenumber is null) left outer JOIN users u with(nolock) ON tc.UserId = u.UserID WHERE tc.uscistransfercontrolid is NOT null AND i9s.i9id = @I9Id UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(tc.dtstamp, null) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') AS 'Username', 'Employee Login by Employer Representative (Transfer Control) ' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid left outer JOIN USCISTransferControl tc with(nolock) ON tc.uscistransfercontrolid = (SELECT max(uscistransfercontrolid) FROM USCISTransferControl with(nolock) WHERE employeeid = e.employeeid AND casenumber is null) WHERE tc.uscistransfercontrolid is NOT null AND i9s.i9id = @I9Id UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 TimeEntered FROM I9Signatures WHERE I9ID = i9s.I9ID AND SignatureSection = 1 AND SignatureSubSection = 1 AND I9SignatureID<> (SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection = 1 ORDER BY  I9SignatureID) ORDER BY  I9SignatureID),(SELECT TOP 1 TimeEntered FROM I9Signatures WHERE I9ID = i9s.I9ID AND SignatureSection = 1 AND SignatureSubSection = 1)) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') AS 'Username', 'Section 1 Signature' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid left outer JOIN USCISTransferControl tc with(nolock) ON tc.uscistransfercontrolid = (SELECT max(uscistransfercontrolid) FROM USCISTransferControl with(nolock) WHERE employeeid = e.employeeid AND casenumber is null) left outer JOIN auditerrors ae with(nolock) ON i9s.i9id = ae.i9id WHERE tc.uscistransfercontrolid is NOT null AND i9s.i9id = @I9Id AND ae.i9id is null AND i9s.I9VersionID>=6 AND (SELECT COUNT(sig.I9SignatureID) FROM I9Signatures sig WITH(NOLOCK) WHERE sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 AND sig.I9ID=i9s.I9ID)>1 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 TimeEntered FROM I9Signatures WHERE I9ID = i9s.I9ID AND SignatureSection = 1 AND SignatureSubSection = 2 AND I9SignatureID<> (SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection = 1 AND SignatureSubSection = 2 ORDER BY  I9SignatureID) ORDER BY  I9SignatureID),(SELECT TOP 1 TimeEntered FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection = 1 AND SignatureSubSection = 2 ORDER BY  I9SignatureID)) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') AS 'Username', 'Section 1 Preparer/Translator signature' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid left outer JOIN USCISTransferControl tc with(nolock) ON tc.uscistransfercontrolid = (SELECT max(uscistransfercontrolid) FROM USCISTransferControl with(nolock) WHERE employeeid = e.employeeid AND casenumber is null) left outer JOIN auditerrors ae with(nolock) ON i9s.i9id = ae.i9id WHERE tc.uscistransfercontrolid is NOT null AND i9s.i9id = @I9Id AND ae.i9id is null AND i9s.I9VersionID>=6 AND (SELECT COUNT(I9SignatureID) FROM I9Signatures sig WITH(NOLOCK) WHERE sig.SignatureSection = 1 AND sig.SignatureSubSection = 2 AND sig.TimeEntered>=tc.dtstamp AND sig.I9ID=i9s.i9id)>0 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.AuditOpen = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp < ae.ErrorDate ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', isnull((CASE WHEN ae.OpenedByUserID IS NOT NULL THEN u.Username WHEN ae.OpenedByUserID IS NULL AND ae.Entity = 'E' THEN isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') WHEN ae.OpenedByUserID IS NULL THEN (SELECT Username FROM Users WHERE u.UserID = as1.UserID) ELSE '' END),'') + CASE WHEN ae.OpenedByUserID IS NULL AND ae.Entity = 'E' THEN '' WHEN ae.Entity = 'F' THEN ' (Administrator) ID: ' ELSE ' (Authorized Rep) ID: ' END + isnull((CASE WHEN ae.OpenedByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN ae.OpenedByUserID IS NULL THEN (SELECT CONVERT(VARCHAR, UserID) FROM Users WHERE u.UserID = as1.UserID) ELSE '' END),'') AS 'Username', 'Employer Representative Login' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode left outer JOIN users u with(nolock) ON ae.OpenedByUserID = u.UserID left outer JOIN AuditLoginTimes as1 with(nolock) ON ae.AuditErrorID = as1.AuditErrorID AND as1.AuditOpen IS NOT NULL WHERE i9s.auditstarttime is NOT null AND ae.OpenedByUserID IS NOT NULL AND i9s.i9id = @I9Id AND i9s.I9VersionID>=6 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(dateadd(ss, -1, ae.errordate), null) AS 'DateAndTime', isnull((CASE WHEN ae.OpenedByUserID IS NOT NULL THEN u.Username WHEN ae.OpenedByUserID IS NULL AND ae.Entity = 'E' THEN isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') WHEN ae.OpenedByUserID IS NULL THEN (SELECT Username FROM Users WHERE u.UserID = as1.UserID) ELSE '' END),'') + CASE WHEN ae.OpenedByUserID IS NULL AND ae.Entity = 'E' THEN '' WHEN ae.Entity='F' THEN ' (Administrator) ID: ' ELSE ' (Authorized Rep) ID: ' END + isnull((CASE WHEN ae.OpenedByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN ae.OpenedByUserID IS NULL THEN (SELECT CONVERT(VARCHAR, UserID) FROM Users WHERE u.UserID = as1.UserID) ELSE '' END),'') AS 'Username', (CASE WHEN ae.Who='System Populated' AND ae.errorcode IN('1a','1b','1c','1d','1e','1f','1g','1h','1i','1j','1k','1l','1m','2a','2b','2c','2d','2e','2f','2g','2h','2i','3a','3b','3c','4a','4b','4c','4d','4e','4f','4g','4h','4i','4j','4k') THEN 'System Populated (N/A)' ELSE (CASE WHEN ae.errorcode IN('1a','1b','1c','1d','1e','1f','1g','1h','1i','1j','1k','1l','1m','2a','2b','2c','2d','2e','2f','2g','2h','2i','3a','3b','3c','4a','4b','4c','4d','4e','4f','4g','4h','4i','4j','4k') THEN 'Section 1 ' WHEN ae.errorcode IN('5a','5b','5c','5d','5e','5f','5g','5h','5i','5j','5k','5l','5m','6a','6b','6c','6d','6e','6f','7a','7b','7c','7d','7e','7f','8a','8b','8c','8d','8e','8f','8g','8h','8i','8j','8k','8l','8m') THEN 'Section 2 ' WHEN ae.errorcode IN('9a','9b','9c','9d','9e','9f','9g','9h','9i','9j','9k','9l','9m','9n','9o') THEN 'Section 3 ' ELSE '' END) +'Audit Opened'  END) AS 'Action', isnull(ac.fieldname, '') AS 'AuditValue', '3' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode left outer JOIN users u with(nolock) ON ae.OpenedByUserID = u.UserID left outer JOIN AuditLoginTimes as1 with(nolock) ON ae.AuditErrorID = as1.AuditErrorID AND as1.AuditOpen IS NOT NULL WHERE i9s.auditstarttime is NOT null AND i9s.i9id = @I9Id AND i9s.I9VersionID>=6 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.EEAuditComplete = 1 AND asig.LoginDTStamp IS NOT NULL ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') AS 'Username', 'Employee Login' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode WHERE ae.entity = 'E' AND isnull(ae.RequestHRCorrection,0)= 0 AND i9s.i9id = @I9Id AND ae.ErrorCode IN('1a','1b','1c','1d','1e','1f','1g','1h','1i','1j','1k','1l','1m','2a','2b','2c','2d','2e','2f','2g','2h','2i','3a','3b','3c','4a','4b','4c','4d','4e','4f','4g','4h','4i','4j','4k') AND i9s.I9VersionID>=6 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', convert(varchar, isnull(ae.CorrectedDate, (SELECT TOP 1 asig.AuditCompleteDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.EEAuditComplete = 1 AND asig.AuditCompleteDTStamp IS NOT NULL ORDER BY  AuditCompleteDTSTamp DESC)),120) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') AS 'Username', 'Employee Audit Completed' AS 'Action', isnull(ac.fieldname, '') + ' Changed: ' + isnull(ae.newvalue, '') AS 'AuditValue', '4' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode WHERE ae.entity = 'E' AND isnull(ae.RequestHRCorrection,0)= 0 AND i9s.i9id = @I9Id AND ae.ErrorCode IN('1a','1b','1c','1d','1e','1f','1g','1h','1i','1j','1k','1l','1m','2a','2b','2c','2d','2e','2f','2g','2h','2i','3a','3b','3c','4a','4b','4c','4d','4e','4f','4g','4h','4i','4j','4k') AND i9s.I9VersionID>=6 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(sig.TimeEntered, null) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') AS 'Username', 'Employee Signature' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID<> (SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection = 1 AND SignatureSubSection = 1) WHERE ae.entity = 'E' AND isnull(ae.RequestHRCorrection,0)= 0 AND i9s.i9id = @I9Id AND i9s.I9VersionID>=6 AND sig.TimeEntered>=ae.ErrorDate UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.S2S3AuditComplete = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= ISNULL(ae.CorrectedDate, isnull((SELECT TOP 1 sig21.TimeEntered FROM I9Signatures sig21 WITH(NOLOCK) WHERE sig21.I9ID=i9s.I9ID AND sig21.TimeEntered>=ae.ErrorDate AND sig21.SignatureSection IN (2,3) AND sig21.I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) ORDER BY sig21.TimeEntered ASC), (SELECT TOP 1 asig.AuditCompleteDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.S2S3AuditComplete = 1 AND asig.AuditCompleteDTStamp IS NOT NULL ORDER BY  AuditCompleteDTSTamp DESC))) ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Employer Representative Login' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection in (2,3) AND sig.I9SignatureID<> (SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE ae.entity = 'C' AND isnull(ae.RequestHRCorrection,0)= 0 AND i9s.i9id = @I9Id AND i9s.I9VersionID>=6 AND (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.S2S3AuditComplete = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= ISNULL(ae.CorrectedDate, isnull((SELECT TOP 1 sig21.TimeEntered FROM I9Signatures sig21 WITH(NOLOCK) WHERE sig21.I9ID=i9s.I9ID AND sig21.TimeEntered>=ae.ErrorDate AND sig21.SignatureSection IN (2,3) AND sig21.I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) ORDER BY sig21.TimeEntered ASC), (SELECT TOP 1 asig.AuditCompleteDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.S2S3AuditComplete = 1 AND asig.AuditCompleteDTStamp IS NOT NULL ORDER BY  AuditCompleteDTSTamp DESC))) ORDER BY  LoginDTSTamp DESC) IS NOT NULL UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', convert(varchar, isnull(ae.CorrectedDate,isnull((SELECT TOP 1 sig21.TimeEntered FROM I9Signatures sig21 WITH(NOLOCK) WHERE sig21.I9ID=i9s.I9ID AND sig21.TimeEntered>=ae.ErrorDate ORDER BY sig21.TimeEntered ASC), (SELECT TOP 1 asig.AuditCompleteDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.S2S3AuditComplete = 1 AND asig.AuditCompleteDTStamp IS NOT NULL AND asig.AuditCompleteDTStamp>=ae.ErrorDate ORDER BY asig.AuditCompleteDTSTamp ASC))), 120) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', (CASE WHEN ae.errorcode IN('1a','1b','1c','1d','1e','1f','1g','1h','1i','1j','1k','1l','1m','2a','2b','2c','2d','2e','2f','2g','2h','2i','3a','3b','3c','4a','4b','4c','4d','4e','4f','4g','4h','4i','4j','4k') THEN 'Section 1 ' WHEN ae.errorcode IN('5a','5b','5c','5d','5e','5f','5g','5h','5i','5j','5k','5l','5m','6a','6b','6c','6d','6e','6f','7a','7b','7c','7d','7e','7f','8a','8b','8c','8d','8e','8f','8g','8h','8i','8j','8k','8l','8m') THEN 'Section 2 ' WHEN ae.errorcode IN('9a','9b','9c','9d','9e','9f','9g','9h','9i','9j','9k','9l','9m','9n','9o') THEN 'Section 3 ' ELSE '' END) +'Audit Completed' AS 'Action', isnull(ac.fieldname, '') + ' Changed: ' + isnull(ae.newvalue, '') AS 'AuditValue', ae.ErrorCode AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection in (2,3) AND sig.I9SignatureID<> (SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE ae.entity = 'C' AND isnull(ae.RequestHRCorrection,0)= 0 AND i9s.i9id = @I9Id AND i9s.I9VersionID>=6 AND convert(varchar, isnull(ae.CorrectedDate,isnull((SELECT TOP 1 sig21.TimeEntered FROM I9Signatures sig21 WITH(NOLOCK) WHERE sig21.I9ID=i9s.I9ID AND sig21.TimeEntered>=ae.ErrorDate ORDER BY sig21.TimeEntered ASC), (SELECT TOP 1 asig.AuditCompleteDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.S2S3AuditComplete = 1 AND asig.AuditCompleteDTStamp IS NOT NULL AND asig.AuditCompleteDTStamp>=ae.ErrorDate ORDER BY asig.AuditCompleteDTSTamp ASC))), 120) IS NOT NULL UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', (case WHEN sig.TimeEntered is NULL THEN null ELSE dateadd(ss, 1, sig.timeentered) end) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Employer Signature' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection in (2,3) AND sig.I9SignatureID<> (SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE ae.entity = 'C' AND isnull(ae.RequestHRCorrection,0)= 0 AND i9s.i9id = @I9Id AND i9s.I9VersionID>=6 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(ae.errordate, null) AS 'DateAndTime', isnull((CASE WHEN ae.OpenedByUserID IS NOT NULL THEN u.Username WHEN ae.OpenedByUserID IS NULL THEN (SELECT Username FROM Users WHERE u.UserID = as1.UserID) ELSE '' END),'') +' (Administrator) ID: ' + isnull((CASE WHEN ae.OpenedByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN ae.OpenedByUserID IS NULL THEN (SELECT CONVERT(VARCHAR, UserID) FROM Users WHERE u.UserID = as1.UserID) ELSE '' END),'') AS 'Username', 'Employer Representative Audit Close' AS 'Action', isnull(ac.fieldname, '') + ' Changed: ' + isnull(ae.newvalue, '') AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode left outer JOIN users u with(nolock) ON ae.OpenedByUserID = u.UserID left outer JOIN AuditLoginTimes as1 with(nolock) ON ae.AuditErrorID = as1.AuditErrorID AND as1.AuditOpen IS NOT NULL WHERE ae.entity = 'F' AND i9s.i9id = @I9Id AND isnull(ae.RequestHRCorrection,0)= 0 AND ae.OpenedByUserID IS NOT NULL AND i9s.I9VersionID>=6 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull( (SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.ReceiptComplete = 1 AND asig.LoginDTStamp IS NOT NULL ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Employer Representative Login' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection = 2 AND sig.I9SignatureID<> (SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE ae.entity = 'R' AND i9s.i9id = @I9Id AND i9s.I9VersionID>=6 AND ae.ErrorCode='5g' UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(ae.errordate, null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Receipt Designation Removed' AS 'Action', isnull(ac.fieldname, '') + ' Changed: ' + (CASE WHEN ae.ErrorCode IN ('5d','5f','5m','6d','7d','9e') THEN CONVERT(VARCHAR,(CAST(ISNULL(ae.newvalue,'') AS DATE)),101) ELSE ISNULL(ae.newvalue,'') END) AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection = 2 AND sig.I9SignatureID<> (SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE ae.entity = 'R' AND i9s.i9id = @I9Id AND i9s.I9VersionID>=6 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(sig.TimeEntered, null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username', 'Receipt Designation Signature' AS 'Action', '' AS 'AuditValue', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection = 2 AND sig.I9SignatureID<> (SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE ae.entity = 'R' AND i9s.i9id = @I9Id AND i9s.I9VersionID>=6 AND ae.ErrorCode='5g' AND sig.TimeEntered>=ae.ErrorDate ORDER BY  'DateAndTime', 'Secret Ordering Field (do not send to ICE)'",
        "Type2" : "SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S1Completion = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section1CompletedTime ORDER BY  LoginDTSTamp DESC), ISNULL((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S1Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section1CompletedTime ORDER BY  LoginDTSTamp DESC), (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 1 AND SignatureSubSection = 1))) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username/ID', 'Employee Login' AS 'Action', '' AS 'Details', '1' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 WHERE i9s.i9id = @I9Id UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S1Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section1CompletedTime ORDER BY  LoginDTSTamp DESC), (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 1 AND SignatureSubSection = 1)) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username/ID', 'Section 1 Personal Information Entered' AS 'Action', '' AS 'Details', '2' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 WHERE i9s.i9id = @I9Id UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S1Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section1CompletedTime ORDER BY  LoginDTSTamp DESC), (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 1 AND SignatureSubSection = 1)) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username/ID', 'Section 1 Attestation Selected' AS 'Action', 'Citizenship Status: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '2a' AND RequestHRCorrection = 0) THEN(CASE(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '2a' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) WHEN '1' THEN 'USC' WHEN '2' THEN 'LPR' WHEN '3' THEN 'AAW' WHEN '4' THEN 'NAT' END) ELSE(CASE ISNULL(CONVERT(varchar, i9s1.CheckboxNumber, 101), '') WHEN '1' THEN 'USC' WHEN '2' THEN 'LPR' WHEN '3' THEN 'AAW' WHEN '4' THEN 'NAT' END)  END) +                 (CASE WHEN ISNULL(i9s1.AlienOrAdmissionNumber,'N/A')<> 'N/A' THEN + CHAR(10) + 'Alien Registration Number/USCIS Number: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '2b' AND RequestHRCorrection = 0) THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '2b' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s1.AlienOrAdmissionNumber,'') END)        WHEN ISNULL(i9s1.AuthAlienUSCISNumber,'N/A')<> 'N/A' THEN + CHAR(10) + 'Alien Registration Number/USCIS Number: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '2c' AND RequestHRCorrection = 0) THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '2c' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s1.AuthAlienUSCISNumber,'') END)        ELSE '' END) +        (CASE WHEN ISNULL(CONVERT(varchar, AuthAlienDate,101),'N/A')<> 'N/A' THEN + CHAR(10) + 'Work Authorization Expiration Date: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '2d' AND RequestHRCorrection = 0) THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '2d' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(CONVERT(varchar, i9s1.AuthAlienDate,101),'') END)         ELSE '' END) +        (CASE WHEN ISNULL(i9s1.I94Number,'N/A')<> 'N/A' THEN + CHAR(10) + 'I-94 Admission Number: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '2e' AND RequestHRCorrection = 0) THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '2e' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s1.I94Number,'') END)         ELSE '' END) +         (CASE WHEN ISNULL(i9s1.ForeignPassportNumber,'N/A')<> 'N/A' THEN + CHAR(10) + 'Foreign Passport Number: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '2f' AND RequestHRCorrection = 0) THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '2f' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s1.ForeignPassportNumber,'') END)          ELSE '' END) +         (CASE WHEN ISNULL(i9s1.ForeignPassportCountry,'N/A')<> 'N/A' THEN + CHAR(10) + 'Foreign Passport Country of Issuance: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '2g' AND RequestHRCorrection = 0) THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '2g' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s1.ForeignPassportCountry,'') END)          ELSE '' END)          AS 'Details', '3' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 LEFT OUTER JOIN I9ValidatedS1 i9s1 WITH(NOLOCK) ON i9s.I9ID = i9s1.I9ID WHERE i9s.i9id = @I9Id UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S1Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section1CompletedTime ORDER BY  LoginDTSTamp DESC), (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 1 AND SignatureSubSection = 1)) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username/ID', 'Section 1 Preparer/Translator Selected (Yes/No)' AS 'Action', '' AS 'Details', '4' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 WHERE i9s.i9id = @I9Id AND i9s.I9VersionID >= 7 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S1PrepSave = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section1CompletedTime ORDER BY  LoginDTSTamp DESC), (SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 1 AND SignatureSubSection = 1)) AS 'DateAndTime', isnull(e.Username, '') + ' (Preparer/Translator) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username/ID', 'Section 1 Preparer/Translator Info Added' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 2 WHERE i9s.i9id = @I9Id UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 1 AND SignatureSubSection = 2),null) AS 'DateAndTime', isnull(e.Username, '') + ' (Preparer/Translator) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username/ID', 'Section 1 Preparer/Translator signature' AS 'Action', '' AS 'Details', '5' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 2 WHERE i9s.i9id = @I9Id UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 1 AND SignatureSubSection = 1),null) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + CONVERT(VARCHAR, e.EmployeeID) AS 'Username/ID', 'Section 1 Signature' AS 'Action', '' AS 'Details', '6' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 WHERE i9s.i9id = @I9Id UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Completion = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime AND asig.LoginDTStamp > (SELECT EmployeeSignatureDate FROM I9ValidatedS1 i9s1 WITH(NOLOCK) WHERE i9s1.I9ID = i9s.I9ID) ORDER BY  LoginDTSTamp DESC),isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime AND asig.LoginDTStamp > (SELECT EmployeeSignatureDate FROM I9ValidatedS1 i9s1 WITH(NOLOCK) WHERE i9s1.I9ID = i9s.I9ID) ORDER BY  LoginDTSTamp DESC),i9s.Section2CompletedTime)) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Employer Representative Login' AS 'Action', '' AS 'Details', '1' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime AND asig.LoginDTStamp > (SELECT EmployeeSignatureDate FROM I9ValidatedS1 i9s1 WITH(NOLOCK) WHERE i9s1.I9ID = i9s.I9ID) ORDER BY  LoginDTSTamp DESC),i9s.Section2CompletedTime) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'List A Documents Entered' AS 'Action', 'List A Document 1 Title: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '5a' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5a' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListADocumentTitle,'') END)        +CHAR(10) +         'List A Issuing Authority 1: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '5b' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5b' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListAIssuingAuthority,'') END)          +CHAR(10) +         'List A Document 1 Number: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '5c' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5c' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListADocument1Num,'') END)          +CHAR(10) +         'List A Document 1 Expiration Date: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '5d' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 CONVERT(VARCHAR,CAST(ISNULL(OldValue,'') AS DATE),101) FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5d' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(CONVERT(varchar, i9s2.ListAExpiration1Date,101),'') END)          +(CASE WHEN i9s2.ListADocument2Num IS NOT NULL THEN(CHAR(10) + 'List A Document 2 Title: ' + (CASE WHEN EXISTS(SELECT * FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5h' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5h' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListADocument2Title, '') END)        + CHAR(10) +        'List A Issuing Authority 2: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '5j' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5j' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListAIssuingAuthority2,'') END)          +CHAR(10) +         'List A Document 2 Number: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '5e' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5e' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListADocument2Num,'') END)          +CHAR(10) +         'List A Document 2 Expiration Date: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '5f' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 CONVERT(VARCHAR,CAST(ISNULL(OldValue,'') AS DATE),101) FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5f' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(CONVERT(varchar, i9s2.ListAExpiration2Date,101),'') END) ) ELSE '' END)         +(CASE WHEN i9s2.ListADocument3Num IS NOT NULL THEN(CHAR(10) + 'List A Document 3 Title: ' + (CASE WHEN EXISTS(SELECT * FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5i' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5i' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListADocument3Title, '') END)        + CHAR(10) +        'List A Issuing Authority 3: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '5k' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5k' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListAIssuingAuthority3,'') END)          +CHAR(10) +         'List A Document 3 Number: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '5l' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5l' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListADocument3Num,'') END)          +CHAR(10) +         'List A Document 3 Expiration Date: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '5m' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 CONVERT(VARCHAR,CAST(ISNULL(OldValue,'') AS DATE),101) FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '5m' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(CONVERT(varchar, i9s2.ListAExpiration3Date,101),'') END) ) ELSE '' END)         AS 'Details', '2' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN i9validatedS2 i9s2 with(nolock) ON i9s.i9id = i9s2.i9id left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s2.ListADocumentID is NOT null UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime AND asig.LoginDTStamp > (SELECT EmployeeSignatureDate FROM I9ValidatedS1 i9s1 WITH(NOLOCK) WHERE i9s1.I9ID = i9s.I9ID) ORDER BY  LoginDTSTamp DESC),i9s.Section2CompletedTime) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'List B Documents Entered' AS 'Action', 'List B Document Title: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '6a' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '6a' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListBDocumentTitle,'') END)         +CHAR(10) +         'List B Issuing Authority: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '6b' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '6b' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListBIssuingAuthority,'') END)          +CHAR(10) +         'List B Document Number: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '6c' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '6c' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListBDocumentNum,'') END)          +CHAR(10) +        'List B Document Expiration Date: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '6d' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 CONVERT(VARCHAR,CAST(ISNULL(OldValue,'') AS DATE),101) FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '6d' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(CONVERT(varchar, i9s2.ListBExpirationDate,101),'') END)          AS 'Details', '3' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN i9validatedS2 i9s2 with(nolock) ON i9s.i9id = i9s2.i9id left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s2.ListBDocumentID is NOT null UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime AND asig.LoginDTStamp > (SELECT EmployeeSignatureDate FROM I9ValidatedS1 i9s1 WITH(NOLOCK) WHERE i9s1.I9ID = i9s.I9ID) ORDER BY  LoginDTSTamp DESC),i9s.Section2CompletedTime) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'List C Documents Entered' AS 'Action', 'List C Document Title: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '7a' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '7a' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListCDocumentTitle,'') END)         +CHAR(10) +         'List C Issuing Authority: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '7b' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '7b' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListCIssuingAuthority,'') END)          +CHAR(10) +         'List C Document Number: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '7c' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '7c' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s2.ListCDocumentNum,'') END)          +CHAR(10) +         'List C Document Expiration Date: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '7d' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 CONVERT(VARCHAR,CAST(ISNULL(OldValue,'') AS DATE),101) FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '7d' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(CONVERT(varchar, i9s2.ListCExpirationDate,101),'') END)          AS 'Details', '4' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN i9validatedS2 i9s2 with(nolock) ON i9s.i9id = i9s2.i9id left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s2.ListCDocumentID is NOT null UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime ORDER BY  LoginDTSTamp DESC),i9s.Section2CompletedTime) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Additional Info box entered' AS 'Action', '' AS 'Details', '5' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN i9validatedS2 i9s2 with(nolock) ON i9s.i9id = i9s2.i9id left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s2.AdditionalInfoListB is NOT null UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S2Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section2CompletedTime AND asig.LoginDTStamp > (SELECT EmployeeSignatureDate FROM I9ValidatedS1 i9s1 WITH(NOLOCK) WHERE i9s1.I9ID = i9s.I9ID) ORDER BY  LoginDTSTamp DESC),i9s.Section2CompletedTime) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Section 2 Hire Date Entered' AS 'Action', '' AS 'Details', '6' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN i9validatedS2 i9s2 with(nolock) ON i9s.i9id = i9s2.i9id left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s2.HireDate is NOT null UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 2 AND SignatureSubSection = 1),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Section 2 Signature' AS 'Action', '' AS 'Details', '7' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 2 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 2 AND SignatureSubSection = 1 ORDER BY  I9SignatureID ASC) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S3Completion = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section3CompletedTime ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Employer Representative Login' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 3 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 3 AND SignatureSubSection = 1 ORDER BY  I9SignatureID) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s.IsReverification = 1 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S3Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section3CompletedTime ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Reverification Documents Entered' AS 'Action', 'Reverification Document Title: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '9c' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '9c' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s3.Section3DocumentTitle,'') END)         +CHAR(10) +         'Reverification Document Number: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '9d' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 ISNULL(OldValue, '') FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '9d' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(i9s3.Section3DocumentNum,'') END)          +CHAR(10) +         'Reverification Expiration Date: ' + (CASE WHEN EXISTS(SELECT* FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID= i9s.I9ID AND ae.ErrorCode= '9e' AND RequestHRCorrection = 0) AND i9s.I9VersionID>=6  THEN(SELECT TOP 1 CONVERT(VARCHAR,CAST(ISNULL(OldValue,'') AS DATE),101) FROM AuditErrors ae WITH(NOLOCK) WHERE ae.I9ID = i9s.I9ID AND ae.ErrorCode = '9e' AND RequestHRCorrection = 0 ORDER BY ae.ErrorDate ASC) ELSE ISNULL(CONVERT(varchar, i9s3.Section3ExpirationDate,101),'') END)          AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 3 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 3 AND SignatureSubSection = 1 ORDER BY  I9SignatureID) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID left outer join i9validateds3 i9s3 with(nolock) on i9s.I9Id = i9s3.I9id WHERE i9s.i9id = @I9Id AND i9s.IsReverification = 1 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 3 AND SignatureSubSection = 1),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Section 3 Signature' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 3 AND sig.SignatureSubSection = 1 left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s.IsReverification = 1 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S3Completion = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section3CompletedTime ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Section 3 Rehire Rep Login' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 3 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 3 AND SignatureSubSection = 1 ORDER BY  I9SignatureID) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s.IsRehire = 1 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.S3Save = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= i9s.Section3CompletedTime ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Section 3 Rehire Date Entered' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 3 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID = (SELECT TOP 1 I9SignatureID FROM I9Signatures WHERE i9s.i9id = i9id AND SignatureSection = 3 AND SignatureSubSection = 1 ORDER BY  I9SignatureID) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s.IsRehire = 1 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT top 1 TimeEntered FROM i9signatures with(nolock) WHERE i9id = i9s.i9id AND signaturesection = 3 AND SignatureSubSection = 1),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Section 3 Rehire signature' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN i9Signatures sig with(nolock) ON i9s.i9id = sig.I9ID AND sig.SignatureSection = 3 AND sig.SignatureSubSection = 1 left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE i9s.i9id = @I9Id AND i9s.IsRehire = 1 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.I9ID = i9s.I9ID AND asig.TransferControl = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= tc.DTStamp ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', isnull(u.username, '') + ' (Authorized Rep) ID: ' + isnull(CONVERT(VARCHAR, u.UserID), '') AS 'Username/ID', 'Employer Representative Login' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid left outer JOIN USCISTransferControl tc with(nolock) ON tc.uscistransfercontrolid = (SELECT max(uscistransfercontrolid) FROM USCISTransferControl with(nolock) WHERE employeeid = e.employeeid AND casenumber is null) left outer JOIN users u with(nolock) ON tc.UserId = u.UserID WHERE tc.uscistransfercontrolid is NOT null AND i9s.i9id = @I9Id UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(tc.dtstamp, null) AS 'DateAndTime', isnull(u.Username, '') + ' (Authorized Rep) ID: ' + isnull(CONVERT(VARCHAR, u.UserID), '') AS 'Username/ID', 'Employer Rep Logs Off (Transfer Control)' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid left outer JOIN USCISTransferControl tc with(nolock) ON tc.uscistransfercontrolid = (SELECT max(uscistransfercontrolid) FROM USCISTransferControl with(nolock) WHERE employeeid = e.employeeid AND casenumber is null) left outer JOIN users u with(nolock) ON tc.UserId = u.UserID WHERE tc.uscistransfercontrolid is NOT null AND i9s.i9id = @I9Id UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(tc.dtstamp, null) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') AS 'Username/ID', 'Employee Login by Employer Representative (Transfer Control) ' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid left outer JOIN USCISTransferControl tc with(nolock) ON tc.uscistransfercontrolid = (SELECT max(uscistransfercontrolid) FROM USCISTransferControl with(nolock) WHERE employeeid = e.employeeid AND casenumber is null) WHERE tc.uscistransfercontrolid is NOT null AND i9s.i9id = @I9Id UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 TimeEntered FROM I9Signatures WHERE I9ID = i9s.I9ID AND SignatureSection = 1 AND SignatureSubSection = 1 AND I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection = 1 ORDER BY  I9SignatureID) ORDER BY  I9SignatureID),(SELECT TOP 1 TimeEntered FROM I9Signatures WHERE I9ID = i9s.I9ID AND SignatureSection = 1 AND SignatureSubSection = 1)) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') AS 'Username/ID', 'Section 1 Signature' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid left outer JOIN USCISTransferControl tc with(nolock) ON tc.uscistransfercontrolid = (SELECT max(uscistransfercontrolid) FROM USCISTransferControl with(nolock) WHERE employeeid = e.employeeid AND casenumber is null) left outer JOIN auditerrors ae with(nolock) ON i9s.i9id = ae.i9id WHERE tc.uscistransfercontrolid is NOT null AND i9s.i9id = @I9Id AND ae.i9id is null AND i9s.I9VersionID >= 6 AND(SELECT COUNT(sig.I9SignatureID) FROM I9Signatures sig WITH(NOLOCK) WHERE sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 AND sig.I9ID = i9s.I9ID) > 1 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 TimeEntered FROM I9Signatures WHERE I9ID = i9s.I9ID AND SignatureSection = 1 AND SignatureSubSection = 2 AND I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection = 1 AND SignatureSubSection = 2 ORDER BY  I9SignatureID) ORDER BY  I9SignatureID),(SELECT TOP 1 TimeEntered FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection = 1 AND SignatureSubSection = 2 ORDER BY  I9SignatureID)) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') AS 'Username/ID', 'Section 1 Preparer/Translator signature' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid left outer JOIN USCISTransferControl tc with(nolock) ON tc.uscistransfercontrolid = (SELECT max(uscistransfercontrolid) FROM USCISTransferControl with(nolock) WHERE employeeid = e.employeeid AND casenumber is null) left outer JOIN auditerrors ae with(nolock) ON i9s.i9id = ae.i9id WHERE tc.uscistransfercontrolid is NOT null AND i9s.i9id = @I9Id AND ae.i9id is null AND i9s.I9VersionID >= 6 AND(SELECT COUNT(I9SignatureID) FROM I9Signatures sig WITH(NOLOCK) WHERE sig.SignatureSection = 1 AND sig.SignatureSubSection = 2 AND sig.TimeEntered >= tc.dtstamp AND sig.I9ID = i9s.i9id) > 0 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.AuditOpen = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp < ae.ErrorDate ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', isnull((CASE WHEN ae.OpenedByUserID IS NOT NULL THEN u.Username WHEN ae.OpenedByUserID IS NULL AND ae.Entity = 'E' THEN isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') WHEN ae.OpenedByUserID IS NULL THEN(SELECT Username FROM Users WHERE u.UserID = as1.UserID) ELSE '' END),'') +CASE WHEN ae.OpenedByUserID IS NULL AND ae.Entity = 'E' THEN '' WHEN ae.Entity = 'F' THEN ' (Administrator) ID: ' ELSE ' (Authorized Rep) ID: ' END + isnull((CASE WHEN ae.OpenedByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN ae.OpenedByUserID IS NULL THEN(SELECT CONVERT(VARCHAR, UserID) FROM Users WHERE u.UserID = as1.UserID) ELSE '' END),'') AS 'Username/ID', 'Employer Representative Login' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode left outer JOIN users u with(nolock) ON ae.OpenedByUserID = u.UserID left outer JOIN AuditLoginTimes as1 with(nolock) ON ae.AuditErrorID = as1.AuditErrorID AND as1.AuditOpen IS NOT NULL WHERE i9s.auditstarttime is NOT null AND ae.OpenedByUserID IS NOT NULL AND i9s.i9id = @I9Id AND i9s.I9VersionID >= 6 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(dateadd(ss, -1, ae.errordate), null) AS 'DateAndTime', isnull((CASE WHEN ae.OpenedByUserID IS NOT NULL THEN u.Username WHEN ae.OpenedByUserID IS NULL AND ae.Entity = 'E' THEN isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') WHEN ae.OpenedByUserID IS NULL THEN(SELECT Username FROM Users WHERE u.UserID = as1.UserID) ELSE '' END),'') +CASE WHEN ae.OpenedByUserID IS NULL AND ae.Entity = 'E' THEN '' WHEN ae.Entity = 'F' THEN ' (Administrator) ID: ' ELSE ' (Authorized Rep) ID: ' END + isnull((CASE WHEN ae.OpenedByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN ae.OpenedByUserID IS NULL THEN(SELECT CONVERT(VARCHAR, UserID) FROM Users WHERE u.UserID = as1.UserID) ELSE '' END),'') AS 'Username/ID', (CASE WHEN ae.Who = 'System Populated' AND ae.errorcode IN('1a','1b','1c','1d','1e','1f','1g','1h','1i','1j','1k','1l','1m','2a','2b','2c','2d','2e','2f','2g','2h','2i','3a','3b','3c','4a','4b','4c','4d','4e','4f','4g','4h','4i','4j','4k') THEN 'System Populated (N/A)' ELSE(CASE WHEN ae.errorcode IN('1a', '1b', '1c', '1d', '1e', '1f', '1g', '1h', '1i', '1j', '1k', '1l', '1m', '2a', '2b', '2c', '2d', '2e', '2f', '2g', '2h', '2i', '3a', '3b', '3c', '4a', '4b', '4c', '4d', '4e', '4f', '4g', '4h', '4i', '4j', '4k') THEN 'Section 1 ' WHEN ae.errorcode IN('5a', '5b', '5c', '5d', '5e', '5f', '5g', '5h', '5i', '5j', '5k', '5l', '5m', '6a', '6b', '6c', '6d', '6e', '6f', '7a', '7b', '7c', '7d', '7e', '7f', '8a', '8b', '8c', '8d', '8e', '8f', '8g', '8h', '8i', '8j', '8k', '8l', '8m') THEN 'Section 2 ' WHEN ae.errorcode IN('9a', '9b', '9c', '9d', '9e', '9f', '9g', '9h', '9i', '9j', '9k', '9l', '9m', '9n', '9o') THEN 'Section 3 ' ELSE '' END) + 'Audit Opened'  END) AS 'Action', isnull(ac.fieldname, '') AS 'Details', '3' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode left outer JOIN users u with(nolock) ON ae.OpenedByUserID = u.UserID left outer JOIN AuditLoginTimes as1 with(nolock) ON ae.AuditErrorID = as1.AuditErrorID AND as1.AuditOpen IS NOT NULL WHERE i9s.auditstarttime is NOT null AND i9s.i9id = @I9Id AND i9s.I9VersionID >= 6 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.EEAuditComplete = 1 AND asig.LoginDTStamp IS NOT NULL ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') AS 'Username/ID', 'Employee Login' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode WHERE ae.entity = 'E' AND isnull(ae.RequestHRCorrection,0)= 0 AND i9s.i9id = @I9Id AND ae.ErrorCode IN('1a','1b','1c','1d','1e','1f','1g','1h','1i','1j','1k','1l','1m','2a','2b','2c','2d','2e','2f','2g','2h','2i','3a','3b','3c','4a','4b','4c','4d','4e','4f','4g','4h','4i','4j','4k') AND i9s.I9VersionID >= 6 UNION all SELECT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', convert(varchar, isnull(ae.CorrectedDate, (SELECT TOP 1 asig.AuditCompleteDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.EEAuditComplete = 1 AND asig.AuditCompleteDTStamp IS NOT NULL ORDER BY  AuditCompleteDTSTamp DESC)),120) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') AS 'Username/ID', 'Employee Audit Completed' AS 'Action', isnull(ac.fieldname, '') + ' Changed: ' + isnull(ae.newvalue, '') AS 'Details', '4' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode WHERE ae.entity = 'E' AND isnull(ae.RequestHRCorrection,0)= 0 AND i9s.i9id = @I9Id AND ae.ErrorCode IN('1a','1b','1c','1d','1e','1f','1g','1h','1i','1j','1k','1l','1m','2a','2b','2c','2d','2e','2f','2g','2h','2i','3a','3b','3c','4a','4b','4c','4d','4e','4f','4g','4h','4i','4j','4k') AND i9s.I9VersionID >= 6 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(sig.TimeEntered, null) AS 'DateAndTime', isnull(e.Username, '') + ' (Employee) ID: ' + isnull(CONVERT(VARCHAR, e.EmployeeID), '') AS 'Username/ID', 'Employee Signature' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection = 1 AND sig.SignatureSubSection = 1 AND sig.I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection = 1 AND SignatureSubSection = 1) WHERE ae.entity = 'E' AND isnull(ae.RequestHRCorrection,0)= 0 AND i9s.i9id = @I9Id AND i9s.I9VersionID >= 6 AND sig.TimeEntered >= ae.ErrorDate UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.S2S3AuditComplete = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= ISNULL(ae.CorrectedDate, isnull((SELECT TOP 1 sig21.TimeEntered FROM I9Signatures sig21 WITH(NOLOCK) WHERE sig21.I9ID = i9s.I9ID AND sig21.TimeEntered >= ae.ErrorDate AND sig21.SignatureSection IN(2, 3) AND sig21.I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) ORDER BY sig21.TimeEntered ASC), (SELECT TOP 1 asig.AuditCompleteDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.S2S3AuditComplete = 1 AND asig.AuditCompleteDTStamp IS NOT NULL ORDER BY  AuditCompleteDTSTamp DESC))) ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Employer Representative Login' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection in (2, 3) AND sig.I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE ae.entity = 'C' AND isnull(ae.RequestHRCorrection,0)= 0 AND i9s.i9id = @I9Id AND i9s.I9VersionID >= 6 AND(SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.S2S3AuditComplete = 1 AND asig.LoginDTStamp IS NOT NULL AND asig.LoginDTStamp <= ISNULL(ae.CorrectedDate, isnull((SELECT TOP 1 sig21.TimeEntered FROM I9Signatures sig21 WITH(NOLOCK) WHERE sig21.I9ID = i9s.I9ID AND sig21.TimeEntered >= ae.ErrorDate AND sig21.SignatureSection IN(2, 3) AND sig21.I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) ORDER BY sig21.TimeEntered ASC), (SELECT TOP 1 asig.AuditCompleteDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.S2S3AuditComplete = 1 AND asig.AuditCompleteDTStamp IS NOT NULL ORDER BY  AuditCompleteDTSTamp DESC))) ORDER BY  LoginDTSTamp DESC) IS NOT NULL UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', convert(varchar, isnull(ae.CorrectedDate, isnull((SELECT TOP 1 sig21.TimeEntered FROM I9Signatures sig21 WITH(NOLOCK) WHERE sig21.I9ID = i9s.I9ID AND sig21.TimeEntered >= ae.ErrorDate ORDER BY sig21.TimeEntered ASC), (SELECT TOP 1 asig.AuditCompleteDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.S2S3AuditComplete = 1 AND asig.AuditCompleteDTStamp IS NOT NULL AND asig.AuditCompleteDTStamp >= ae.ErrorDate ORDER BY asig.AuditCompleteDTSTamp ASC))), 120) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', (CASE WHEN ae.errorcode IN('1a','1b','1c','1d','1e','1f','1g','1h','1i','1j','1k','1l','1m','2a','2b','2c','2d','2e','2f','2g','2h','2i','3a','3b','3c','4a','4b','4c','4d','4e','4f','4g','4h','4i','4j','4k') THEN 'Section 1 ' WHEN ae.errorcode IN('5a','5b','5c','5d','5e','5f','5g','5h','5i','5j','5k','5l','5m','6a','6b','6c','6d','6e','6f','7a','7b','7c','7d','7e','7f','8a','8b','8c','8d','8e','8f','8g','8h','8i','8j','8k','8l','8m') THEN 'Section 2 ' WHEN ae.errorcode IN('9a','9b','9c','9d','9e','9f','9g','9h','9i','9j','9k','9l','9m','9n','9o') THEN 'Section 3 ' ELSE '' END) +'Audit Completed' AS 'Action', isnull(ac.fieldname, '') + ' Changed: ' + isnull(ae.newvalue, '') AS 'Details', ae.ErrorCode AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection in (2, 3) AND sig.I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE ae.entity = 'C' AND isnull(ae.RequestHRCorrection,0)= 0 AND i9s.i9id = @I9Id AND i9s.I9VersionID >= 6 AND convert(varchar, isnull(ae.CorrectedDate, isnull((SELECT TOP 1 sig21.TimeEntered FROM I9Signatures sig21 WITH(NOLOCK) WHERE sig21.I9ID = i9s.I9ID AND sig21.TimeEntered >= ae.ErrorDate ORDER BY sig21.TimeEntered ASC), (SELECT TOP 1 asig.AuditCompleteDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.S2S3AuditComplete = 1 AND asig.AuditCompleteDTStamp IS NOT NULL AND asig.AuditCompleteDTStamp >= ae.ErrorDate ORDER BY asig.AuditCompleteDTSTamp ASC))), 120) IS NOT NULL UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', (case WHEN sig.TimeEntered is NULL THEN null ELSE dateadd(ss, 1, sig.timeentered) end) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Employer Signature' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection in (2, 3) AND sig.I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE ae.entity = 'C' AND isnull(ae.RequestHRCorrection,0)= 0 AND i9s.i9id = @I9Id AND i9s.I9VersionID >= 6 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(ae.errordate, null) AS 'DateAndTime', isnull((CASE WHEN ae.OpenedByUserID IS NOT NULL THEN u.Username WHEN ae.OpenedByUserID IS NULL THEN(SELECT Username FROM Users WHERE u.UserID = as1.UserID) ELSE '' END),'') +' (Administrator) ID: ' + isnull((CASE WHEN ae.OpenedByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN ae.OpenedByUserID IS NULL THEN(SELECT CONVERT(VARCHAR, UserID) FROM Users WHERE u.UserID = as1.UserID) ELSE '' END),'') AS 'Username/ID', 'Employer Representative Audit Close' AS 'Action', isnull(ac.fieldname, '') + ' Changed: ' + isnull(ae.newvalue, '') AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode left outer JOIN users u with(nolock) ON ae.OpenedByUserID = u.UserID left outer JOIN AuditLoginTimes as1 with(nolock) ON ae.AuditErrorID = as1.AuditErrorID AND as1.AuditOpen IS NOT NULL WHERE ae.entity = 'F' AND i9s.i9id = @I9Id AND isnull(ae.RequestHRCorrection,0)= 0 AND ae.OpenedByUserID IS NOT NULL AND i9s.I9VersionID >= 6 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull((SELECT TOP 1 asig.LoginDTStamp FROM AuditLoginTimes asig WITH(NOLOCK) WHERE asig.AuditErrorID = ae.AuditErrorID AND asig.ReceiptComplete = 1 AND asig.LoginDTStamp IS NOT NULL ORDER BY  LoginDTSTamp DESC),null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Employer Representative Login' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection = 2 AND sig.I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE ae.entity = 'R' AND i9s.i9id = @I9Id AND i9s.I9VersionID >= 6 AND ae.ErrorCode = '5g' UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(ae.errordate, null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Receipt Designation Removed' AS 'Action', isnull(ac.fieldname, '') + ' Changed: ' + (CASE WHEN ae.ErrorCode IN ('5d','5f','5m','6d','7d','9e') THEN CONVERT(VARCHAR,(CAST(ISNULL(ae.newvalue,'') AS DATE)),101) ELSE ISNULL(ae.newvalue,'') END) AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection = 2 AND sig.I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE ae.entity = 'R' AND i9s.i9id = @I9Id AND i9s.I9VersionID >= 6 UNION all SELECT DISTINCT isnull(e.employeeid, '') AS 'FragomenID', isnull(i9s.i9id, '') AS 'I9ID', isnull(sig.TimeEntered, null) AS 'DateAndTime', (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN u.Username WHEN sig.EnteredByAgentID IS NOT NULL THEN a.Username ELSE '' END) +' (Authorized Rep) ID: ' + (CASE WHEN sig.EnteredByUserID IS NOT NULL THEN CONVERT(VARCHAR, u.UserID) WHEN sig.EnteredByAgentID IS NOT NULL THEN CONVERT(VARCHAR, a.AgentID) ELSE '' END) AS 'Username/ID', 'Receipt Designation Signature' AS 'Action', '' AS 'Details', '' AS 'Secret Ordering Field (do not send to ICE)' FROM employees e with(nolock) INNER JOIN companydivisions cd with(nolock) ON cd.companydivisionid = e.companydivisionid INNER JOIN i9s with(nolock) ON i9s.employeeid = e.employeeid INNER JOIN auditerrors ae with(nolock) ON ae.i9id = i9s.i9id INNER JOIN auditcodes ac with(nolock) ON ac.errorcode = ae.errorcode INNER JOIN i9signatures sig with(nolock) ON i9s.i9id = sig.i9id AND sig.SignatureSection = 2 AND sig.I9SignatureID<>(SELECT TOP 1 I9SignatureID FROM I9Signatures WITH(NOLOCK) WHERE I9ID = i9s.I9ID AND SignatureSection IN(2, 3)) left outer JOIN users u with(nolock) ON sig.EnteredByUserID = u.UserID left outer JOIN agents a with(nolock) ON sig.EnteredByAgentID = a.AgentID WHERE ae.entity = 'R' AND i9s.i9id = @I9Id AND i9s.I9VersionID >= 6 AND ae.ErrorCode = '5g' AND sig.TimeEntered >= ae.ErrorDate ORDER BY  'DateAndTime', 'Secret Ordering Field (do not send to ICE)'"
    }
}

